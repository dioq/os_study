# 操作系统底层知识

## 计算机启动分为四个过程:
BIOS ----> MBR----> 启动盘启动 ----> 操作系统

## 1. BIOS 介绍
BIOS全称Base Input & Outout System， 是焊在板子上的rom代码，主要工作是检测、初始化硬件、获取硬件详细的参数(比如系统的CPU型号，系统时间)。建立中断向量表，通过 int 0x13 中断 从设备中寻找用于启动的磁盘(硬盘或者软盘或者其他)并加载执行。
### 1. 实模式下1MB内存布局
![BIOS](https://user-images.githubusercontent.com/15027024/226439348-1356e2a6-1140-459e-b1e7-be1cc5c2a154.png)
16位实时模式下,地址总线是20位,能够访问1MB的内存空间，地址范围为0x00000——0xFFFFF。其中0xF0000——0xFFFFF这64KB的内存是ROM，存的是BIOS代码。

### 2. BIOS启动
BIOS是一段程序，需要有个入口地址去执行，由内存布局可以发现该地址在0xFFFF0处。    </br>
在开机一瞬间，CPU的 cs:ip 寄存器强制初始化为0xF000: 0xFFF0。该部分内存只有16B（16字节空间），存的是跳转指令：jmp f000 : e05b。由此正式跳转启动了BIOS代码。   </br>
在这之后，BIOS便开始进行硬件检测，初始化硬件等工作。硬件检测包括:内存条是否可用、显示器是否可用、硬盘是否损等。初始化硬件包括初始化 GDT、IDT表   </br>
BIOS最后的指令是中断int 0x13，该中断会加载启动盘的第一个扇区的代码，俗称MBR     </br>

### 3. 从启动盘加载 MBR 到 0x7c00 处并执行
BIOS最后一项工作是校验启动盘中位于0盘0道1扇区的内容，这里存放的便是MBR（主引导记录）。    </br>
也就是读取最前面的512个字节。如果这512个字节的最后两个字节是0x55和0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给"启动顺序"中的下一个设备。 </br>
在确认该扇区内容为MBR后，BIOS便将其加载到物理地址0x7c00处，随后跳转到此地址继续执行（执行MBR）。  </br>


## 2. MBR  介绍
MBR 全称 Master Boot Record 主引导记录,大小必须是 512 字节，主要作用是，告诉计算机到启动盘的哪一个位置去找操作系统。 </br>
主引导记录由三个部分组成：   </br>
![MBR](https://user-images.githubusercontent.com/15027024/226443650-54aa7b48-8ffa-4b4b-9957-1b20d3741c8b.png)
（1） 第1-446字节：bootstrap代码(446字节，用到的只有前面440字节)调用操作系统的机器码。    </br>
（2） 第447-510字节：分区表(64字节)（Partition table）。    </br>
（3） 第511-512字节：主引导记录签名（0x55和0xAA），通过这2字节的值判断该硬盘是不是真的可用于启动。    </br>

分区表的作用，是将启动盘分成若干个区。   </br>
MBR会加找到启动盘的活动分区(分区)，并且加载其中的代码，如果系统有bootloader，则加载bootloader。常见的bootloader有grub，lilo。    </br>
加载bootloader后，系统会提示选择哪个操作系统，对于装了多个操作系统的硬盘，bootloader会定位到正确的扇区加载内核镜像   </br>
所谓的加载无非就是拷贝代码到ram,然后jmp到目的地址开始执行代码    </br>
</br>
</br>
名词介绍:   </br>
启动盘  	可以是软盘也可以是硬盘   </br>
